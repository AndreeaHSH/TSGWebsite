<!-- AdminDashboard/src/app/components/reports/reports.component.html -->
<div class="reports-container">

  <!-- Header Section -->
  <div class="reports-header">
    <div class="header-content">
      <h1 class="page-title">
        <span class="title-icon">📊</span>
        Rapoarte și Statistici
      </h1>
      <p class="page-description">
        Gestionează rapoartele de activitate și vizualizează statisticile echipei
      </p>
    </div>

    <div class="header-actions">
      <button
        class="btn btn-primary"
        (click)="openReportModal()"
        title="Adaugă raport nou">
        <span class="btn-icon">➕</span>
        Raport nou
      </button>

      <button
        class="btn btn-secondary"
        (click)="exportReports()"
        title="Exportă rapoarte">
        <span class="btn-icon">📥</span>
        Export
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Se încarcă rapoartele...</p>
  </div>

  <!-- Main Content (when not loading) -->
  <div *ngIf="!isLoading" class="reports-content">

    <!-- Navigation Tabs -->
    <div class="nav-tabs">
      <button
        class="tab-button"
        [class.active]="activeTab === 'overview'"
        (click)="setActiveTab('overview')">
        <i class="fas fa-chart-line"></i>
        Prezentare generală
      </button>

      <button
        class="tab-button"
        [class.active]="activeTab === 'reports'"
        (click)="setActiveTab('reports')">
        <i class="fas fa-list"></i>
        Rapoarte detaliate
      </button>

      <button
        class="tab-button"
        [class.active]="activeTab === 'statistics'"
        (click)="setActiveTab('statistics')">
        <i class="fas fa-chart-pie"></i>
        Statistici
      </button>
    </div>

    <!-- Tab Content -->
    <div class="tab-content">

      <!-- Overview Tab -->
      <div *ngIf="activeTab === 'overview'" class="section">
        <div class="overview-cards">
          <div class="stat-card" *ngIf="statistics">
            <div class="card-icon">📋</div>
            <div class="card-content">
              <h3>{{ statistics.summary.totalReports }}</h3>
              <p>Rapoarte totale</p>
            </div>
          </div>

          <div class="stat-card" *ngIf="statistics">
            <div class="card-icon">⏰</div>
            <div class="card-content">
              <h3>{{ statistics.summary.totalHours }}</h3>
              <p>Ore lucrate</p>
            </div>
          </div>

          <div class="stat-card" *ngIf="statistics">
            <div class="card-icon">👥</div>
            <div class="card-content">
              <h3>{{ statistics.summary.activeMembers }}</h3>
              <p>Membri activi</p>
            </div>
          </div>

          <div class="stat-card" *ngIf="statistics">
            <div class="card-icon">🚀</div>
            <div class="card-content">
              <h3>{{ statistics.summary.activeProjects }}</h3>
              <p>Proiecte active</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Reports Tab -->
      <div *ngIf="activeTab === 'reports'" class="section">

        <!-- Filters Section -->
        <div class="filters-section">
          <h3>Filtre</h3>
          <div class="filters-grid">
            <div class="filter-group">
              <label for="year-filter">An</label>
              <select id="year-filter" [(ngModel)]="filters.year" (change)="applyFilters()">
                <option [value]="2023">2023</option>
                <option [value]="2024">2024</option>
                <option [value]="2025">2025</option>
              </select>
            </div>

            <div class="filter-group">
              <label for="month-filter">Luna</label>
              <select id="month-filter" [(ngModel)]="filters.month" (change)="applyFilters()">
                <option [value]="undefined">Toate lunile</option>
                <option *ngFor="let month of months" [value]="month.value">
                  {{ month.name }}
                </option>
              </select>
            </div>

            <div class="filter-group">
              <label for="department-filter">Departament</label>
              <select id="department-filter" [(ngModel)]="filters.department" (change)="applyFilters()">
                <option [value]="undefined">Toate departamentele</option>
                <option *ngFor="let dept of departments" [value]="dept">
                  {{ dept }}
                </option>
              </select>
            </div>

            <div class="filter-actions">
              <button class="btn btn-secondary" (click)="resetFilters()">
                Resetează filtrele
              </button>
            </div>
          </div>
        </div>

        <!-- Reports Table -->
        <div class="reports-table-container">
          <div class="table-header">
            <div class="col col-member" (click)="sortReports('memberName')">
              Membru <i class="fas fa-sort"></i>
            </div>
            <div class="col col-department">
              Departament
            </div>
            <div class="col col-project" (click)="sortReports('projectName')">
              Proiect <i class="fas fa-sort"></i>
            </div>
            <div class="col col-period" (click)="sortReports('month')">
              Perioadă <i class="fas fa-sort"></i>
            </div>
            <div class="col col-hours" (click)="sortReports('hoursWorked')">
              Ore <i class="fas fa-sort"></i>
            </div>
            <div class="col col-actions">Acțiuni</div>
          </div>

          <div *ngFor="let report of filteredReports" class="table-row">
            <div class="col col-member">
              <div class="member-info">
                <strong>{{ report.memberName }}</strong>
              </div>
            </div>
            <div class="col col-department">
              <span
                class="department-badge"
                [style.background-color]="getDepartmentColor(report.memberDepartment)">
                {{ getDepartmentDisplayName(report.memberDepartment) }}
              </span>
            </div>
            <div class="col col-project">
              {{ report.projectName }}
            </div>
            <div class="col col-period">
              {{ getMonthName(report.month) }} {{ report.year }}
            </div>
            <div class="col col-hours">
              <span class="hours-badge">{{ report.hoursWorked }}h</span>
            </div>
            <div class="col col-actions">
              <button class="btn btn-sm btn-info" (click)="openReportDetail(report)">
                <i class="fas fa-eye"></i>
              </button>
              <button class="btn btn-sm btn-secondary" (click)="openReportModal(report)">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn btn-sm btn-danger" (click)="deleteReport(report.id)">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>
        </div>

        <div *ngIf="filteredReports.length === 0" class="no-data">
          <i class="fas fa-inbox"></i>
          <p>Nu există rapoarte pentru criteriile selectate.</p>
        </div>
      </div>

      <!-- Statistics Tab -->
      <div *ngIf="activeTab === 'statistics'" class="section">
        <div class="statistics-content">
          <h3>Statistici detaliate</h3>

          <!-- Department Statistics -->
          <div *ngIf="hasDepartmentStats" class="stats-section">
            <h4>Statistici pe departamente</h4>
            <div class="department-stats">
              <div *ngFor="let dept of departmentStats" class="dept-stat-card">
                <h5>{{ dept.department }}</h5>
                <div class="dept-stats">
                  <span>{{ dept.reportCount }} rapoarte</span>
                  <span>{{ dept.totalHours }} ore</span>
                  <span>{{ dept.memberCount }} membri</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Project Statistics -->
          <div *ngIf="hasProjectStats" class="stats-section">
            <h4>Statistici pe proiecte</h4>
            <div class="project-stats">
              <div *ngFor="let proj of projectStats" class="project-stat-card">
                <h5>{{ proj.projectName }}</h5>
                <div class="project-stats">
                  <span>{{ proj.reportCount }} rapoarte</span>
                  <span>{{ proj.totalHours }} ore</span>
                  <span>{{ proj.contributorCount }} contributori</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Report Modal -->
  <div *ngIf="showReportModal" class="modal-overlay" (click)="closeReportModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>{{ editingReport ? 'Editează raport' : 'Raport nou' }}</h3>
        <button class="close-btn" (click)="closeReportModal()">×</button>
      </div>

      <div class="modal-body">
        <form (ngSubmit)="saveReport()">
          <div class="form-group">
            <label for="workDescription">Descrierea muncii</label>
            <textarea
              id="workDescription"
              [(ngModel)]="reportForm.workDescription"
              name="workDescription"
              rows="4"
              required>
            </textarea>
          </div>

          <div class="form-group">
            <label for="hoursWorked">Ore lucrate</label>
            <input
              type="number"
              id="hoursWorked"
              [(ngModel)]="reportForm.hoursWorked"
              name="hoursWorked"
              required>
          </div>

          <div class="form-group">
            <label for="achievements">Realizări</label>
            <textarea
              id="achievements"
              [(ngModel)]="reportForm.achievements"
              name="achievements"
              rows="3">
            </textarea>
          </div>

          <div class="form-group">
            <label for="challenges">Provocări</label>
            <textarea
              id="challenges"
              [(ngModel)]="reportForm.challenges"
              name="challenges"
              rows="3">
            </textarea>
          </div>

          <div class="form-actions">
            <button type="button" class="btn btn-secondary" (click)="closeReportModal()">
              Anulează
            </button>
            <button type="submit" class="btn btn-primary">
              {{ editingReport ? 'Actualizează' : 'Creează' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
